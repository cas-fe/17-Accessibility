<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge, chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Accessibility</title>
    <link href="assets/css/main.css" media="all" rel="stylesheet" type="text/css" />
    <style>
      .suggestions {
        display: none;
      }
      .suggestions.is-visible {
        display: block;
      }
    </style>
  </head>
  <body>
    <header role="banner">
      <h1><span>Demo 6.1:</span> Inaccessible auto-suggest</h1>
    </header>
    <main role="main">
      <input type="text" class="autosuggest">
    </main>
    <hr>
    <a class="js-toggle" href="#issues">Show issues</a>
    <div class="issues is-invisible js-details" id="issues">
      <h2>Issues</h2>
      <ul>
        <li>Suggestions not keyboard or screenreader accessible.</li>
        <li>Screenreader users receivce no information about the suggestions.</li>
      </ul>
    </div>
    <hr>
    <nav role="navigation">
      <a class="next" href="6-2_autosuggest-accessible.html">Forward to "<span>Demo 6.2:</span> Accessible auto-suggest" »</a>
      <a class="prev" href="5-1_button-inaccessible.html">« Back to "<span>Demo 5.1:</span> Inaccessible fake buttons"</a>
      <a class="index" href="index.html">Index</a>
    </nav>
    <script src="assets/js/main.js" type="text/javascript"></script>
    <script>
      // WARNING: This code is for demo purposes only and does not work in IE < 9
      ;(function() {
      	'use strict';

        function submitRequest(query, field, container) {
          var request = new XMLHttpRequest();

          request.onload = function() {
            var response = JSON.parse(request.responseText);

            if (response && response.suggestions) {
              showSuggestions(response.suggestions, field, container);
            }
          };

          request.open('get', 'data/suggestions.json', true);
          request.send();
        }

        function showSuggestions(suggestions, field, container) {
          container.innerHTML = '';
          container.classList.add('is-visible');

          suggestions.forEach(function(text) {
            var item = document.createElement('div');

            item.innerHTML = text;

            container.appendChild(item);

            item.addEventListener('click', function(event) {
              setValue(field, container, text);
            }, false);
          });
        }

        function setValue(field, container, value) {
          field.value = value;
          
          hideSuggestions(field, container);
        }

        function hideSuggestions(field, container) {
          field.focus();

          container.innerHTML = '';
          container.classList.remove('is-visible');
        }
      
      	[].forEach.call(document.querySelectorAll('.autosuggest'), function(field) {
          var container = document.createElement('div');

          container.classList.add('suggestions');

          field.parentNode.insertBefore(container, field.nextSibling);
      
          field.addEventListener('keyup', function(event) {
            var val = event.target.value;
            
            // Submit Ajax request (unless enter or esc keys were used)
            if (event.keyCode !== 13 && event.keyCode !== 27 && val.length > 1) {
              submitRequest(val, event.target, container);
            }
          }, false);
        });
      })();
    </script>
  </body>
</html>
